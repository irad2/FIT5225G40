<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="styles.css">
    <script type="text/javascript" src="https://gc.kis.v2.scr.kaspersky-labs.com/FD126C42-EBFA-4E12-B309-BB3FDD723AC1/main.js?attr=pfIJQtGygSS4RMtK4mcWx5M-FTd_LN1dpTh4N7kwV4YEPTVfszdbQwqXRBxZtcB7j1GcCA6XEIZwMsJ1ms902Pno315DYVkqNWAjFVRQir2y52QMr1taMzOhf89gDcMKFeRFSLwIKuXYu9XcIBz-9vlzBCkRSe_q77A2L-MCPX0NS4qS3qBW1i1ISIn7JSCYQ95dQlqlAaWO627qPcYzH8JFBn6Uhn7bB4m2YWijMRhdXK_N7isBqLSjAQcinYelFGkKmSDh-BlTu3AqQdsM-bxbi2gJvf9G25q761zlq-3giwf4uMWVnS7gawGyL6D1cBai_KfHvB_pWno3G4TUGA1BiBJbaXDvikZ_Lxpq0iqx0NnSC3GGkESj9f7cTVqjlgFEOg1E8W1sXcCfdKUs961C7IXSljLmVuhoJF20xrHHW615xxmwf6NtTmK_S2FJr95haODSm1iISz5hOh2Nx5ShHx7L1l3bMLM4vTK3qtxQTpwWa6Bf66p7l6siyGQ7HYkiAAS92Hs2MRSU8JzXqLz3hdwUtSv8tIz4abZfxCU-ydhTNILdcXSdzaImMEp-iS6EF5KbovhvyxK_oKlK1r87NGA72XxtdgolDaka4M_GCg-s_xvMJxKJB5ncekmqmMRCrDSortq-dNYSLh_ylJpQ5Aeob8Sw48-uEEj--1otdqY9TvnzsciRiUDWVW8CC6tim93qdTGUMLzE2y-9jb-CrHHdOJvai56s_fb3D7fbaupDcxWNMtFpg_19B52FLuwFw_kzuz7qOJ7ZGvWGSstV6xYqaQXcHOldPeadDLLYzbeVbiPA_StOoJQdtkqnRhxDZJT4uWw2t19z2lOIeOlr7Fs8J6wROia-7yTSiImRWmnOEq6RyI2vmp97nAyeadsX6oeMhG6ogtR5eNzWBeRU_HnjMKFuKky0C2bAw_0v9rK4YomoCdXNXPpQe9uh0hqGBuBLwtWK4T5nFTByqmlDsuvKaP4EjsoN0VOY2uBYX-C0-97H1Z6hVhlEjsSKsfsWbQST5j34msH0aCCf8I5aGpFcslM0XstMzpCaodqrErkGiQnScKj_ceYo2FjrdhBZOh-r4qik7fLEifDUp2XyV3b-loak7rW-ZqcvciQGYEzztFC8rxSZ6Z_9g-wccWvr8lBWJO8TruSangBgJq_PpcC_3iHaieVyuIGoxTI3l4owyhCjekrjlrP8VfhRsX936kUpgud8MQxpMg1qRMrK7y0rTzNfolgakG_N3WYlgdCYaQwuMmF1KYsGZqNVOOlQTkFdPuwgRy67ewqnG3Cl7URLM-8NoifydpdZSC9U5PpxGoSgSdTmQXObpxzc_4d3HCoYEJ0oRdtpLeu-TpJMtXCNzfAyRyrWO5xKmGDcsQzlaEQeuqLe7d-xz3izMA5r5g48fZP-EQwLDG7RJSSfjT-poYCqGW8LVtg0cGR5yiKzTNkyQtNros1v1clvVNdE56jmcwlDZthvn2-aOb76a4n3ipYmrwNUdCx__FUPgoFVMLykia7HUA5o4Fk18ffUNhBAl4sGB5j45JMym60OEHxaptxdk4gcOeh7WSg3NAJu7qgnF8BRlIUQSLmzHpBowbo6xCLiEPdsqmKba3xg0lwVzUVlCceCAPZ9nQzLsuu_suqX0iD44T06T2QQPHNmztzPAOdQRNeMb50C-aGMDuS4MwSXbRXoNvO_iIPI7q_o7GOv5dhtZEc3ahOeAQgau2UHezqOj5FVTSBJFIWxtSeRWAIIvfGbAMDc5e7SsBrT-YzZub14KhF-drnteoGDcvu0w0bE169s5DAXdiZZnzZy21PvfQxrYmxNSas_8kEvf580SHkZhQVIFhEdmw0ZWQ2-qUvWEmXHKwHxLgc0h_uY2HFUUkkjmM9pQ6fc3_nP5_B9zkwvtDcqSt9vZjhDvOJwsYbkKVNrhZBbYtLXreztV2DdW5kiAazDoggg0TFPsN8GuR6HnURh7p1zBUnxvxagrrXxEMER2ix7NOZHmm1Ku5mJ7jN8tQvZybyjFv3TMtX2fJvGoYTF6_FG" charset="UTF-8"></script><script type="text/javascript" src="https://gc.kis.v2.scr.kaspersky-labs.com/FD126C42-EBFA-4E12-B309-BB3FDD723AC1/main.js?attr=6tS9ja7SUQYoae30QyjaDUB-FeOIOIEU50b4CZdGVw6rjNmzWrcJyyYxIJbU16e8dGuP2lpZojiVHMXigF7gfEqTFL3C3fX6qrSIJdMqw9X3mNhSC_hp_G-KvHHpiHet7d2EcwRkDOmLvujS08x8GZ2eo7-S1JUcwbjSHdhNa0yCi56RlTMbyyA2toX9WhfCgKx9b5gvbWLEMm1XrEu9wWyATsIQg7jnjyzF1RMW9xQqddpEYdpNxoXuFdiNvQmTAvsJ48tkgzjr8TQ2pTn9X8UwY-ZUd1koX_DD_6Oz9jVa0XeSKN4AEWvM-9JLCVpJXLgfGi2eXowGPHfVLCXfFgAvR6r3Dk6zs1V-eFyjFtdLx5YXu24p7-LtJJCt9Or6kwXi2LgwDPUlP3gHxP7usbPfa5-A6SwKnWUaB-r6N7sCYAD6WhyQQwiHL7WTW22R_-rJy9CYYjfw909-vi-udP3YnmCHJyZIt1eM2s45svs32oUz3ffSL4Mdlvre3OaBrp9fCEOa5oVTMYvorbw69e_DbkDm7hF79TJcs3EC33IDpjp-tEewEmumOkCXRVWWDYVUk_0X7LOoagVXtj89kwRSLoRGg3ZtKnuhkw_u0mWJV0Xm8e3vHJ-aZjVRjbTmC8UcpfINGIw8jCgoGGUr2nfLnP1yPD6tvPlgOKq-KG4iIbHAYUj6Z3lWG5XyhJi9FKTBWGCC_nc2cdjkly6Sdk4VxrDnh7tkZmRcjd0HHR_XTZSmnmVS6np9W7jGMoOnl5zMtlGm0Frjhsv8JycDXeFT8uFic9L_Mw31qzlhjHkmCmys2DuLSQ5u3kUCjg_-9bskgPS3_NCSIuRre4h9meOtuWinWpZEemR9ojZKBYvm7qP_7q61Ho6keL6ItU3xIFA8XfDvMoEoGkcWkOmPzgr6AhBA9Ffdak2k3E-cz6u98m-JiDduJOQKmGSsghud0pLYpOwrrxnkGcEZ13YLIDAHifHph888xhd4AhwaANjZ3BP3uiUwj6tKQVC_mwmazSNU8OSx3AoN-SOTES3Q4dPE1UDtkBvowrPARUMvK81O1Xyde9rTVWZIkmYv4Sg4GVOBHZIAwWG0YvzoxxfaF-BkROXoE3oz6lNOxkEWg5M6Cz0eQUcHWOSjIPomZ1qBkyX05Ryy7SFhK3XiJV5zKQpLrqx_pbgrjKjthbarnUGBFdMLoyljtGOFKWEW12uZ_ovKAYFAaCQwDTuPviO-gsawpkey6_xrszGjwqMk4P5N_AWFx-wGVyLRp4u8a0qFp3k9VVCz0SiSo5Vpplu_rxVY8_2qtKu4wiCIyPbQ_tOxiUD6_QDDeV6-4UtTZnr3X7U-2dnDnyEUybqtEAoQvmgvZ_sPUnTU1Lne9JqnGGZ-iOxVJ7KXaT55-swLgg3Y8rCwj-i2SXuu58eZBEDLfemRSUjuG2cNxtc1JE7ICWpCjAYD7K12JXiHuUI9hYzEFMGwqZgrQF63Mj5iz3UZtEyi0Cg8DlP8YxvlcE8hElIA5FkY8o8mVqOO9U6buvxrPOcgAnC9ClwS5BoRbVqabP0zDD0u8g4Zf4mLoTCNr9ioRFelPunWzgwEp6bYpOCGhIx2To6a3TJ50rvhQ4IKXflKBY5ohvjhdBok7gYQsFrxo9ZQiUEKNOP7xPnFqitnxwQEgsHb7djfUaRz-SyYIxw7fDb9Evj-I5_OiFSicSIX1Dr93dtwBrlgQJhLlzIFLMddwKYSZeSKMf40rImPxUYHir4KQeyZylRSShIg296-Wy5Y0U84cnpdZXdL-Lrp3_3lssSmvibCXw7Bbq4JEyZ_YGTuXBfSPwUogYmeADom3KxF7p4kUD4fOLPkYrg42MxIOXC7kquac-ZzxLCWP_xvOkYI4po5wsEI5_7RWwzx_nol7LtZh7MYgSQaxCV3MBRlupvV-A5wsMrlCN-STIxxA42ShscwQ8QxW1r6dhIYSKFXgAZDkShEacPMrAOkA3t3idWREG_lds0ggeILTQ" charset="UTF-8"></script><script src="https://sdk.amazonaws.com/js/aws-sdk-2.800.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/amazon-cognito-identity-js@5.2.2/dist/amazon-cognito-identity.min.js"></script>
</head>
<body>
    <header>
        <h1>PixTag</h1>
        <button id="sign-in-button" class="auth-button">Sign In</button>
        <button id="sign-out-button" class="auth-button">Sign Out</button>
    </header>

    <div class="container" id="upload-container" style="display:none;">
        <h2>Upload Image</h2>
        <div class="form-group">
            <label for="image-upload">Choose an image:</label>
            <input type="file" id="image-upload">
        </div>
        <button id="upload-button">Upload</button>
        <p id="upload-status"></p>
    </div>
    <div class="container" id="query-container" style="display:none;">
        <h2>Submit Query</h2>
        <div class="form-group">
            <label for="tags-input">Enter tags (separated by commas):</label>
            <input type="text" id="tags-input" placeholder="e.g. person, car, cat">
        </div>
        <button id="search-button">Search</button>
        <div class="results" id="query-results"></div>
        <p id="morning-message"></p>
        <p id="query-status"></p>
    </div>

    <script>
        AWS.config.region = 'us-east-1';
        AWS.config.credentials = new AWS.CognitoIdentityCredentials({
            IdentityPoolId: 'us-east-1_hW70eixMZ'
        });

        function uploadImage() {
            var statusElement = document.getElementById('upload-status');
            statusElement.innerText = 'Preparing to upload...';

            var files = document.getElementById('image-upload').files;
            if (files.length > 0) {
                var file = files[0];
                var s3 = new AWS.S3({
                    apiVersion: '2006-03-01',
                    params: { Bucket: 'fit5225-gp40-photos' }
                });
                var params = {
                    Bucket: 'fit5225-gp40-photos',
                    Key: 'uploaded_images_test/' + file.name,
                    Body: file,
                    ACL: 'public-read'
                };
                s3.upload(params, function(err, data) {
                    if (err) {
                        console.log(err, err.stack);
                        statusElement.innerText = 'Upload failed: ' + err.message;
                    } else {
                        console.log('Successfully uploaded file.', data);
                        statusElement.innerText = 'Upload successful!';
                    }
                }).on('httpUploadProgress', function(progress) {
                    var percent = Math.round((progress.loaded / progress.total) * 100);
                    statusElement.innerText = 'Upload in progress: ' + percent + '%';
                });
            } else {
                statusElement.innerText = 'No file selected for upload.';
            }
        }


        function submitQuery() {
            var messageElement = document.getElementById('morning-message');
            messageElement.innerText = 'Good Morning World';

            var statusElement = document.getElementById('query-status');
            statusElement.innerText = 'Preparing to submit query...';

            var tags = document.getElementById('tags-input').value.split(',');
            var params = {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ tags: tags })
            };
            fetch('https://d3ftuvrpg4.execute-api.us-east-1.amazonaws.com/prod/find_thumbnail_urls_by_tags', params)
                .then(response => response.json())
                .then(data => {
                    console.log(data);
                    var resultsContainer = document.getElementById('query-results');
                    resultsContainer.innerHTML = '';
                    if (data.links && data.links.length > 0) {
                        data.links.forEach(function(url) {
                            var img = document.createElement('img');
                            img.src = url;
                            img.className = 'thumbnail';
                            img.onclick = function() {
                                window.open(url.replace('-thumb', ''), '_blank');
                            };
                            resultsContainer.appendChild(img);
                        });
                        statusElement.innerText = 'Query successful! Found ' + data.links.length + ' images.';
                    } else {
                        statusElement.innerText = 'No images found for the given tags.';
                    }
                })
                .catch(error => {
                    console.log('Error:', error);
                    statusElement.innerText = 'Query failed: ' + error.message;
                });
        }
    </script>
    <script src="auth2.js"></script>
</body>
</html>
